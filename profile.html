<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Linkchain — Perfil Público</title>
<style>
  :root{
    --bg:#071027;
    --card:#0b1220;
    --accent:#06b6d4;
    --text:#ffffff;
    --muted:#94a3b8;
  }

  body{
    margin:0;
    font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
    min-height:100vh;
    background:var(--bg);
    color:var(--text);
    display:flex;
    justify-content:center;
    align-items:center;
    padding:20px;
  }

  .card{
    width:100%;
    max-width:400px;
    background:var(--card);
    border-radius:20px;
    padding:30px 20px;
    box-shadow:0 0 20px rgba(6,182,212,0.6);
    text-align:center;
    position:relative;
    animation: neonPulse 2s infinite alternate;
  }

  @keyframes neonPulse {
    0% { box-shadow: 0 0 10px rgba(6,182,212,0.4), 0 0 20px rgba(6,182,212,0.3), 0 0 30px rgba(6,182,212,0.2);}
    50% { box-shadow: 0 0 20px rgba(6,182,212,0.6), 0 0 40px rgba(6,182,212,0.5), 0 0 60px rgba(6,182,212,0.4);}
    100% { box-shadow: 0 0 15px rgba(6,182,212,0.5), 0 0 30px rgba(6,182,212,0.4), 0 0 45px rgba(6,182,212,0.3);}
  }

  .avatar{
    width:120px;
    height:120px;
    border-radius:50%;
    overflow:hidden;
    margin:0 auto 16px;
    background:#1a1f2d;
    display:flex;
    justify-content:center;
    align-items:center;
  }

  .avatar img{
    width:100%;
    height:100%;
    object-fit:cover;
  }

  .name{
    font-weight:700;
    font-size:24px;
    margin-bottom:6px;
    word-break:break-word;
  }

  .address{
    font-size:14px;
    color:var(--muted);
    margin-bottom:20px;
    word-break:break-all;
  }

  .links{
    display:flex;
    flex-direction:column;
    gap:12px;
  }

  .links a{
    display:block;
    padding:12px 20px;
    border-radius:12px;
    text-decoration:none;
    font-weight:600;
    transition:0.2s;
    background:var(--accent);
    color:#042027;
  }

  .links a:hover{
    opacity:0.8;
    transform:translateY(-2px);
  }

  .footer{
    margin-top:20px;
    font-size:12px;
    color:var(--muted);
  }

  /* Responsividade */
  @media(max-width:500px){
    .card{
      padding:20px 16px;
    }
    .avatar{
      width:96px;
      height:96px;
    }
    .name{
      font-size:20px;
    }
    .links a{
      padding:10px 16px;
      font-size:14px;
    }
  }

  @media(max-width:360px){
    .avatar{
      width:80px;
      height:80px;
    }
    .name{
      font-size:18px;
    }
    .links a{
      font-size:13px;
    }
  }
</style>
</head>
<body>
  <div class="card">
    <div class="avatar"><img id="avatarImg" src="" alt="Avatar"></div>
    <div class="name" id="profileName">Carregando...</div>
    <div class="address" id="profileAddr">—</div>
    <div class="links" id="profileLinks"></div>
    <div class="footer">Linkchain — Perfil Público</div>
  </div>

  <script type="module">
    import { ethers } from "https://cdn.jsdelivr.net/npm/ethers@6.11.1/dist/ethers.min.js";

    const CONTRACT_ADDRESS = "0xab93225dbf590478b4487bf1bf577db629aa6bee";
    const RPC_URL = "https://data-seed-prebsc-1-s1.binance.org:8545/";

    const ABI = [
      "function getProfile(address user) public view returns (string memory)"
    ];

    const el = (id)=>document.getElementById(id);
    const profileName = el('profileName');
    const profileAddr = el('profileAddr');
    const avatarImg = el('avatarImg');
    const profileLinks = el('profileLinks');

    const params = new URLSearchParams(window.location.search);
    const userAddress = params.get('addr');
    if (!userAddress) {
      profileName.textContent = "Endereço inválido";
      profileAddr.textContent = "—";
      throw new Error("Endereço não fornecido na URL. Ex: profile.html?addr=0x1234...");
    }

    profileAddr.textContent = userAddress;

    async function loadProfile() {
      try {
        const provider = new ethers.JsonRpcProvider(RPC_URL);
        const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, provider);
        const json = await contract.getProfile(userAddress);

        if (json) {
          const obj = JSON.parse(json);

          profileName.textContent = obj.name || 'Sem nome';
          avatarImg.src = obj.photo || '';
          profileLinks.innerHTML = '';
          if(obj.links){
            obj.links.forEach(l=>{
              const a = document.createElement('a');
              a.href = l.url;
              a.textContent = l.label;
              a.target='_blank';
              a.style.background = obj.theme?.accent || 'var(--accent)';
              a.style.color = '#042027';
              profileLinks.appendChild(a);
            });
          }

        } else {
          profileName.textContent = "Perfil vazio";
        }
      } catch(e) {
        profileName.textContent = "Erro ao carregar perfil";
        console.error(e);
      }
    }

    loadProfile();
  </script>
</body>
</html>
