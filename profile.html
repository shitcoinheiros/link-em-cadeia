<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Linkchain — Perfil Público</title>
  <style>
    :root{
      --bg:#071027;
      --accent:#06b6d4;
      --text:#ffffff;
      --muted:#94a3b8;
    }

    body{
      font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
      margin:0;
      min-height:100vh;
      background:var(--bg);
      color:var(--text);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }

    .card{
      width:100%;
      max-width:880px;
      background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);
      border-radius:12px;
      padding:20px;
      box-shadow:0 8px 30px rgba(2,6,23,0.6);
    }

    .profile-preview{
      background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);
      padding:20px;
      border-radius:12px;
      text-align:center;
    }

    .avatar{
      width:120px;
      height:120px;
      border-radius:16px;
      margin:0 auto;
      overflow:hidden;
      background:#0b1220;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .avatar img{
      width:100%;
      height:100%;
      object-fit:cover;
    }

    .name{
      font-weight:700;
      font-size:22px;
      margin:12px 0 4px 0;
      word-break:break-word;
    }

    .address{
      font-size:13px;
      color:var(--muted);
      margin-bottom:12px;
      word-break:break-all;
    }

    .links a{
      display:block;
      margin:6px 0;
      text-decoration:none;
      font-weight:600;
      transition:.2s;
    }

    .links a:hover{
      opacity:.7;
    }

    /* Responsividade */
    @media(max-width:600px){
      .card{
        padding:16px;
      }
      .profile-preview{
        padding:16px;
      }
      .avatar{
        width:96px;
        height:96px;
      }
      .name{
        font-size:18px;
      }
      .links a{
        font-size:14px;
      }
    }

    @media(max-width:400px){
      body{
        padding:12px;
      }
      .avatar{
        width:80px;
        height:80px;
      }
      .name{
        font-size:16px;
      }
      .links a{
        font-size:13px;
      }
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="profile-preview" id="profileBox">
      <div class="avatar"><img id="avatarImg" src="" alt="Avatar"></div>
      <div class="name" id="profileName">Carregando...</div>
      <div class="address" id="profileAddr">—</div>
      <div class="links" id="profileLinks"></div>
    </div>
  </div>

  <script type="module">
    import { ethers } from "https://cdn.jsdelivr.net/npm/ethers@6.11.1/dist/ethers.min.js";

    const CONTRACT_ADDRESS = "0xab93225dbf590478b4487bf1bf577db629aa6bee";
    const RPC_URL = "https://data-seed-prebsc-1-s1.binance.org:8545/";

    const ABI = [
      "function getProfile(address user) public view returns (string memory)"
    ];

    const el = (id)=>document.getElementById(id);
    const profileName = el('profileName');
    const profileAddr = el('profileAddr');
    const avatarImg = el('avatarImg');
    const profileLinks = el('profileLinks');
    const profileBox = el('profileBox');

    const params = new URLSearchParams(window.location.search);
    const userAddress = params.get('addr');
    if (!userAddress) {
      profileName.textContent = "Endereço inválido";
      profileAddr.textContent = "—";
      throw new Error("Endereço não fornecido na URL. Ex: profile.html?addr=0x1234...");
    }

    profileAddr.textContent = userAddress;

    async function loadProfile() {
      try {
        const provider = new ethers.JsonRpcProvider(RPC_URL);
        const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, provider);
        const json = await contract.getProfile(userAddress);

        if (json) {
          const obj = JSON.parse(json);

          profileName.textContent = obj.name || 'Sem nome';
          avatarImg.src = obj.photo || '';
          profileLinks.innerHTML = '';
          if(obj.links){
            obj.links.forEach(l=>{
              const a = document.createElement('a');
              a.href = l.url;
              a.textContent = l.label;
              a.target='_blank';
              a.style.color = (obj.theme?.accent) || 'var(--accent)';
              profileLinks.appendChild(a);
            });
          }

          profileBox.style.background = obj.theme?.bg || 'var(--bg)';
          profileBox.style.color = obj.theme?.text || 'var(--text)';
        } else {
          profileName.textContent = "Perfil vazio";
        }
      } catch(e) {
        profileName.textContent = "Erro ao carregar perfil";
        console.error(e);
      }
    }

    loadProfile();
  </script>
</body>
</html>
